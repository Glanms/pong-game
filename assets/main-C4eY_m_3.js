(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const e of h)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(h){const e={};return h.integrity&&(e.integrity=h.integrity),h.referrerPolicy&&(e.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?e.credentials="include":h.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(h){if(h.ep)return;h.ep=!0;const e=i(h);fetch(h.href,e)}})();class n{x;y;size;dx;dy;speed;constructor(t,i,s,h,e,r){this.x=t,this.y=i,this.size=s,this.dx=h,this.dy=e,this.speed=r}update(t){this.x+=this.dx,this.y+=this.dy,(this.y<=0||this.y+this.size>=t)&&(this.dy=-this.dy)}reset(t,i){this.x=t/2-this.size/2,this.y=i/2-this.size/2,this.dx=this.speed*(Math.random()>.5?1:-1),this.dy=this.speed*(Math.random()*2-1)}checkPaddleCollision(t){if(this.x<t.x+t.width&&this.x+this.size>t.x&&this.y<t.y+t.height&&this.y+this.size>t.y){const s=(this.y+this.size/2-(t.y+t.height/2))/(t.height/2)*(Math.PI/3),h=this.dx>0?-1:1;this.dx=h*this.speed*Math.cos(s),this.dy=this.speed*Math.sin(s);const e=Math.sqrt(this.dx*this.dx+this.dy*this.dy);return this.dx=this.dx/e*this.speed,this.dy=this.dy/e*this.speed,!0}return!1}draw(t){t.save();const i=t.createRadialGradient(this.x+this.size/2,this.y+this.size/2,0,this.x+this.size/2,this.y+this.size/2,this.size/2);i.addColorStop(0,"#3399ff"),i.addColorStop(.7,"#66ccff"),i.addColorStop(1,"#99ddff"),t.fillStyle=i,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const s=t.createRadialGradient(this.x+this.size/2.5,this.y+this.size/3,0,this.x+this.size/2.5,this.y+this.size/3,this.size/1.5);s.addColorStop(0,"rgba(255, 255, 255, 0.9)"),s.addColorStop(.7,"rgba(255, 255, 255, 0.2)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=s,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const h=t.createRadialGradient(this.x+this.size/2.8,this.y+this.size/3.5,0,this.x+this.size/2.8,this.y+this.size/3.5,this.size/4);h.addColorStop(0,"rgba(255, 255, 255, 1)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const e=t.createRadialGradient(this.x+this.size/2,this.y+this.size/2,this.size/2.2,this.x+this.size/2,this.y+this.size/2,this.size/2);e.addColorStop(0,"rgba(255, 255, 255, 0)"),e.addColorStop(.8,"rgba(200, 230, 255, 0.1)"),e.addColorStop(1,"rgba(200, 230, 255, 0.3)"),t.fillStyle=e,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill(),t.restore()}}class l{x;y;width;height;dy;speed;score;constructor(t,i,s,h,e){this.x=t,this.y=i,this.width=s,this.height=h,this.dy=0,this.speed=e,this.score=0}update(t){this.y+=this.dy,this.y<0?this.y=0:this.y+this.height>t&&(this.y=t-this.height)}moveUp(t){this.y-=this.speed*t,this.y<0&&(this.y=0)}moveDown(t,i){this.y+=this.speed*t,this.y+this.height>i&&(this.y=i-this.height)}setDirection(t){this.dy=t*this.speed}addScore(t=1){this.score+=t}resetScore(){this.score=0}resetPosition(t){this.y=t,this.dy=0}draw(t){t.fillStyle="#fff",t.fillRect(this.x,this.y,this.width,this.height)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class d{x;y;width;height;speed;score;difficulty;constructor(t,i,s,h,e,r="medium"){this.x=t,this.y=i,this.width=s,this.height=h,this.speed=e,this.difficulty=r,this.score=0}update(t,i,s,h){let e=t-this.height/2;switch(this.difficulty){case"easy":if(this.speed=3,Math.random()>.7)return;e=t-this.height/2+s*.5;break;case"medium":this.speed=5,e=t-this.height/2+s*.8;break;case"hard":this.speed=7,e=t-this.height/2+s*1.2,e+=Math.random()*20-10;break}e=Math.max(0,Math.min(h-this.height,e));const r=e>this.y?1:-1,o=Math.abs(e-this.y);o>5&&(this.y+=r*Math.min(this.speed,o))}addScore(t=1){this.score+=t}resetScore(){this.score=0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}draw(t){t.fillStyle="#fff",t.fillRect(this.x,this.y,this.width,this.height)}}class c{playerScore;aiScore;x;y;fontSize;fontFamily;color;constructor(t,i,s=48,h="#fff",e="Arial"){this.playerScore=0,this.aiScore=0,this.x=t,this.y=i,this.fontSize=s,this.color=h,this.fontFamily=e}addPlayerScore(t=1){this.playerScore+=t}addAIScore(t=1){this.aiScore+=t}reset(){this.playerScore=0,this.aiScore=0}draw(t){t.font=`${this.fontSize}px ${this.fontFamily}`,t.fillStyle=this.color,t.textAlign="center",t.fillText(this.playerScore.toString(),this.x,this.y,this.x*2),t.fillText(this.aiScore.toString(),this.x*3,this.y,this.x*2)}getScores(){return{player:this.playerScore,ai:this.aiScore}}}class y{canvas;ctx;ball;player;ai;score;gameState="menu";getGameState(){return this.gameState}lastTime=0;animationFrameId=null;keys=new Set;PADDLE_WIDTH=12;PADDLE_HEIGHT=100;BALL_SIZE=16;PADDLE_OFFSET=20;WINNING_SCORE=5;constructor(){this.canvas=document.getElementById("pong"),this.ctx=this.canvas.getContext("2d"),this.initializeGameObjects(),this.addEventListeners(),this.lastTime=0,this.startGame()}initializeGameObjects(){const{width:t,height:i}=this.canvas,s=7;this.ball=new n(t/2-this.BALL_SIZE/2,i/2-this.BALL_SIZE/2,this.BALL_SIZE,s*(Math.random()>.5?1:-1),s*(Math.random()*2-1),s),this.player=new l(this.PADDLE_OFFSET,i/2-this.PADDLE_HEIGHT/2,this.PADDLE_WIDTH,this.PADDLE_HEIGHT,10),this.ai=new d(t-this.PADDLE_OFFSET-this.PADDLE_WIDTH,i/2-this.PADDLE_HEIGHT/2,this.PADDLE_WIDTH,this.PADDLE_HEIGHT,5,"medium"),this.score=new c(t/4,60,48,"#fff","Arial")}addEventListeners(){window.addEventListener("keydown",t=>{this.keys.add(t.key.toLowerCase()),t.key===" "&&(this.gameState==="menu"||this.gameState==="paused")?this.startGame():t.key==="Escape"&&(this.gameState==="playing"?this.pauseGame():this.gameState==="paused"&&this.resumeGame())}),window.addEventListener("keyup",t=>{this.keys.delete(t.key.toLowerCase())}),this.canvas.addEventListener("mousemove",t=>{if(this.gameState==="playing"){const i=this.canvas.getBoundingClientRect(),s=t.clientY-i.top-this.player.height/2;this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,s))}}),this.canvas.addEventListener("touchmove",t=>{if(t.preventDefault(),this.gameState==="playing"){const i=this.canvas.getBoundingClientRect(),s=t.touches[0].clientY-i.top-this.player.height/2;this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,s))}},{passive:!1})}startGame(){if(console.log("Starting game..."),this.gameState==="menu"||this.gameState==="paused"){this.gameState="playing",this.lastTime=performance.now();try{this.score?this.score.reset():(console.warn("Score not initialized, resetting game objects..."),this.initializeGameObjects()),(!this.ball||!this.player||!this.ai)&&(console.warn("Some game objects not initialized, reinitializing..."),this.initializeGameObjects()),this.resetRound(),console.log("Starting game loop..."),this.loop()}catch(t){console.error("Error starting game:",t),this.gameState="menu"}}}pauseGame(){this.gameState="paused",this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}resumeGame(){this.gameState==="paused"&&(this.gameState="playing",this.lastTime=performance.now(),this.loop())}loop(t=0){const i=(t-this.lastTime)/1e3;this.lastTime=t,this.update(i),this.render(),this.gameState==="playing"&&(this.animationFrameId=requestAnimationFrame(s=>this.loop(s)))}update(t){if(this.gameState!=="playing")return;const{height:i}=this.canvas;(this.keys.has("w")||this.keys.has("arrowup"))&&(this.player.y=Math.max(0,this.player.y-this.player.speed)),(this.keys.has("s")||this.keys.has("arrowdown"))&&(this.player.y=Math.min(i-this.player.height,this.player.y+this.player.speed)),this.ai.update(this.ball.y,this.ball.x,this.ball.dy,i),this.ball.update(i),this.checkCollisions(),this.checkScore()}resetRound(){const{width:t,height:i}=this.canvas;this.ball.reset(t,i)}render(){const{width:t,height:i}=this.canvas;if(this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t,i),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.setLineDash([5,15]),this.ctx.beginPath(),this.ctx.moveTo(t/2,0),this.ctx.lineTo(t/2,i),this.ctx.stroke(),this.ctx.setLineDash([]),this.ball.draw(this.ctx),this.player.draw(this.ctx),this.ai.draw(this.ctx),this.score.draw(this.ctx),this.ctx.fillStyle="#fff",this.ctx.font="24px Arial",this.ctx.textAlign="center",this.gameState==="menu")this.ctx.fillText("按空格键开始游戏",t/2,i/2),this.ctx.font="16px Arial",this.ctx.fillText("使用 W/S 或 方向键 或 鼠标 移动球拍",t/2,i/2+40);else if(this.gameState==="paused")this.ctx.fillText("游戏已暂停",t/2,i/2),this.ctx.font="16px Arial",this.ctx.fillText("按空格键继续",t/2,i/2+40);else if(this.gameState==="game_over"){const s=this.score.playerScore>this.score.aiScore?"玩家":"电脑";this.ctx.fillText(`${s} 获胜！`,t/2,i/2),this.ctx.font="16px Arial",this.ctx.fillText("按空格键重新开始",t/2,i/2+40)}}checkCollisions(){this.ball.checkPaddleCollision(this.player),this.ball.checkPaddleCollision(this.ai)}checkScore(){const{width:t}=this.canvas;this.ball.x<0?(this.score.addAIScore(),this.resetRound()):this.ball.x>t&&(this.score.addPlayerScore(),this.resetRound()),(this.score.playerScore>=this.WINNING_SCORE||this.score.aiScore>=this.WINNING_SCORE)&&(this.gameState="game_over")}}document.addEventListener("DOMContentLoaded",()=>{const a=new y;a.startGame(),document.addEventListener("keydown",t=>{(t.code==="Space"||t.code==="Escape")&&(a.getGameState()==="playing"?a.pauseGame():a.resumeGame())})});document.addEventListener("touchstart",a=>{a.preventDefault()},{passive:!1});
