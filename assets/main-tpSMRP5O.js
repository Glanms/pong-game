(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const i of h)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(h){const i={};return h.integrity&&(i.integrity=h.integrity),h.referrerPolicy&&(i.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?i.credentials="include":h.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(h){if(h.ep)return;h.ep=!0;const i=e(h);fetch(h.href,i)}})();class d{x;y;size;dx;dy;speed;constructor(t,e,s,h,i,a){this.x=t,this.y=e,this.size=s,this.dx=h,this.dy=i,this.speed=a}update(t){this.x+=this.dx,this.y+=this.dy,(this.y<=0||this.y+this.size>=t)&&(this.dy=-this.dy)}reset(t,e){this.x=t/2-this.size/2,this.y=e/2-this.size/2,this.dx=this.speed*(Math.random()>.5?1:-1),this.dy=this.speed*(Math.random()*2-1)}checkPaddleCollision(t){if(this.x<t.x+t.width&&this.x+this.size>t.x&&this.y<t.y+t.height&&this.y+this.size>t.y){const s=(this.y+this.size/2-(t.y+t.height/2))/(t.height/2)*(Math.PI/3),h=this.dx>0?-1:1;this.dx=h*this.speed*Math.cos(s),this.dy=this.speed*Math.sin(s);const i=Math.sqrt(this.dx*this.dx+this.dy*this.dy);return this.dx=this.dx/i*this.speed,this.dy=this.dy/i*this.speed,!0}return!1}draw(t){t.save();const e=t.createRadialGradient(this.x+this.size/2,this.y+this.size/2,0,this.x+this.size/2,this.y+this.size/2,this.size/2);e.addColorStop(0,"#3399ff"),e.addColorStop(.7,"#66ccff"),e.addColorStop(1,"#99ddff"),t.fillStyle=e,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const s=t.createRadialGradient(this.x+this.size/2.5,this.y+this.size/3,0,this.x+this.size/2.5,this.y+this.size/3,this.size/1.5);s.addColorStop(0,"rgba(255, 255, 255, 0.9)"),s.addColorStop(.7,"rgba(255, 255, 255, 0.2)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=s,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const h=t.createRadialGradient(this.x+this.size/2.8,this.y+this.size/3.5,0,this.x+this.size/2.8,this.y+this.size/3.5,this.size/4);h.addColorStop(0,"rgba(255, 255, 255, 1)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill();const i=t.createRadialGradient(this.x+this.size/2,this.y+this.size/2,this.size/2.2,this.x+this.size/2,this.y+this.size/2,this.size/2);i.addColorStop(0,"rgba(255, 255, 255, 0)"),i.addColorStop(.8,"rgba(200, 230, 255, 0.1)"),i.addColorStop(1,"rgba(200, 230, 255, 0.3)"),t.fillStyle=i,t.beginPath(),t.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,Math.PI*2),t.fill(),t.restore()}}class c{x;y;width;height;dy;speed;score;constructor(t,e,s,h,i){this.x=t,this.y=e,this.width=s,this.height=h,this.dy=0,this.speed=i,this.score=0}update(t){this.y+=this.dy,this.y<0?this.y=0:this.y+this.height>t&&(this.y=t-this.height)}moveUp(t){this.y-=this.speed*t,this.y<0&&(this.y=0)}moveDown(t,e){this.y+=this.speed*t,this.y+this.height>e&&(this.y=e-this.height)}setDirection(t){this.dy=t*this.speed}addScore(t=1){this.score+=t}resetScore(){this.score=0}resetPosition(t){this.y=t,this.dy=0}draw(t){t.fillStyle="#fff",t.fillRect(this.x,this.y,this.width,this.height)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class y{x;y;width;height;speed;score;difficulty;constructor(t,e,s,h,i,a="medium"){this.x=t,this.y=e,this.width=s,this.height=h,this.speed=i,this.difficulty=a,this.score=0}update(t,e,s,h){let i=t-this.height/2;switch(this.difficulty){case"easy":if(this.speed=3,Math.random()>.7)return;i=t-this.height/2+s*.5;break;case"medium":this.speed=5,i=t-this.height/2+s*.8;break;case"hard":this.speed=7,i=t-this.height/2+s*1.2,i+=Math.random()*20-10;break}i=Math.max(0,Math.min(h-this.height,i));const a=i>this.y?1:-1,r=Math.abs(i-this.y);r>5&&(this.y+=a*Math.min(this.speed,r))}addScore(t=1){this.score+=t}resetScore(){this.score=0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}draw(t){t.fillStyle="#fff",t.fillRect(this.x,this.y,this.width,this.height)}}class m{playerScore;aiScore;x;y;fontSize;fontFamily;color;constructor(t,e,s=48,h="#fff",i="Arial"){this.playerScore=0,this.aiScore=0,this.x=t,this.y=e,this.fontSize=s,this.color=h,this.fontFamily=i}addPlayerScore(t=1){this.playerScore+=t}addAIScore(t=1){this.aiScore+=t}reset(){this.playerScore=0,this.aiScore=0}draw(t){t.font=`${this.fontSize}px ${this.fontFamily}`,t.fillStyle=this.color,t.textAlign="center",t.fillText(this.playerScore.toString(),this.x,this.y,this.x*2),t.fillText(this.aiScore.toString(),this.x*3,this.y,this.x*2)}getScores(){return{player:this.playerScore,ai:this.aiScore}}}class f{canvas;ctx;ball;player;ai;score;gameState="menu";getGameState(){return this.gameState}lastTime=0;animationFrameId=null;keys=new Set;PADDLE_WIDTH=12;PADDLE_HEIGHT=100;BALL_SIZE=16;PADDLE_OFFSET=20;WINNING_SCORE=5;constructor(){this.canvas=document.getElementById("pong"),this.ctx=this.canvas.getContext("2d"),this.setupResponsiveCanvas(),this.initializeGameObjects(),this.addEventListeners(),this.lastTime=0,this.startGame()}setupResponsiveCanvas(){const t=()=>{const e=this.canvas.parentElement;if(!e)return;const s=e.getBoundingClientRect(),h=Math.min(800,s.width-40);let i,a;window.innerWidth<=480?(i=Math.min(h,320),a=i*.6666666666666666):window.innerWidth<=768?(i=Math.min(h,480),a=i*.75):(i=Math.min(h,800),a=i*.625),this.canvas.width=i,this.canvas.height=a,this.initializeGameObjects()};t(),window.addEventListener("resize",()=>{t(),this.gameState==="playing"&&this.render()})}initializeGameObjects(){const{width:t,height:e}=this.canvas,s=Math.min(t/800,e/500),h=Math.max(8,Math.floor(this.PADDLE_WIDTH*s)),i=Math.max(60,Math.floor(this.PADDLE_HEIGHT*s)),a=Math.max(12,Math.floor(this.BALL_SIZE*s)),r=Math.max(15,Math.floor(this.PADDLE_OFFSET*s)),n=7*s;this.ball=new d(t/2-a/2,e/2-a/2,a,n*(Math.random()>.5?1:-1),n*(Math.random()*2-1),n),this.player=new c(r,e/2-i/2,h,i,10*s),this.ai=new y(t-r-h,e/2-i/2,h,i,5*s,"medium");const l=Math.max(24,Math.floor(48*s));this.score=new m(t/4,Math.max(30,Math.floor(60*s)),l,"#fff","Arial")}addEventListeners(){window.addEventListener("keydown",t=>{this.keys.add(t.key.toLowerCase()),t.key===" "&&(this.gameState==="menu"||this.gameState==="paused")?this.startGame():t.key==="Escape"&&(this.gameState==="playing"?this.pauseGame():this.gameState==="paused"&&this.resumeGame())}),window.addEventListener("keyup",t=>{this.keys.delete(t.key.toLowerCase())}),this.canvas.addEventListener("mousemove",t=>{if(this.gameState==="playing"){const e=this.canvas.getBoundingClientRect(),s=t.clientY-e.top-this.player.height/2;this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,s))}}),this.canvas.addEventListener("touchmove",t=>{if(t.preventDefault(),this.gameState==="playing"){const e=this.canvas.getBoundingClientRect(),s=t.touches[0].clientY-e.top-this.player.height/2;this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,s))}},{passive:!1})}startGame(){if(console.log("Starting game..."),this.gameState==="menu"||this.gameState==="paused"){this.gameState="playing",this.lastTime=performance.now();try{this.score?this.score.reset():(console.warn("Score not initialized, resetting game objects..."),this.initializeGameObjects()),(!this.ball||!this.player||!this.ai)&&(console.warn("Some game objects not initialized, reinitializing..."),this.initializeGameObjects()),this.resetRound(),console.log("Starting game loop..."),this.loop()}catch(t){console.error("Error starting game:",t),this.gameState="menu"}}}pauseGame(){this.gameState="paused",this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}resumeGame(){this.gameState==="paused"&&(this.gameState="playing",this.lastTime=performance.now(),this.loop())}loop(t=0){const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.render(),this.gameState==="playing"&&(this.animationFrameId=requestAnimationFrame(s=>this.loop(s)))}update(t){if(this.gameState!=="playing")return;const{height:e}=this.canvas;(this.keys.has("w")||this.keys.has("arrowup"))&&(this.player.y=Math.max(0,this.player.y-this.player.speed)),(this.keys.has("s")||this.keys.has("arrowdown"))&&(this.player.y=Math.min(e-this.player.height,this.player.y+this.player.speed)),this.ai.update(this.ball.y,this.ball.x,this.ball.dy,e),this.ball.update(e),this.checkCollisions(),this.checkScore()}resetRound(){const{width:t,height:e}=this.canvas;this.ball.reset(t,e)}render(){const{width:t,height:e}=this.canvas;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t,e),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.setLineDash([5,15]),this.ctx.beginPath(),this.ctx.moveTo(t/2,0),this.ctx.lineTo(t/2,e),this.ctx.stroke(),this.ctx.setLineDash([]),this.ball.draw(this.ctx),this.player.draw(this.ctx),this.ai.draw(this.ctx),this.score.draw(this.ctx),this.ctx.fillStyle="#fff";const s=Math.min(t/800,e/500),h=Math.max(16,Math.floor(24*s)),i=Math.max(12,Math.floor(16*s));if(this.ctx.font=`${h}px Arial`,this.ctx.textAlign="center",this.gameState==="menu")this.ctx.fillText("按空格键开始游戏",t/2,e/2),this.ctx.font=`${i}px Arial`,this.ctx.fillText("使用 W/S 或 方向键 或 鼠标 移动球拍",t/2,e/2+40*s);else if(this.gameState==="paused")this.ctx.fillText("游戏已暂停",t/2,e/2),this.ctx.font=`${i}px Arial`,this.ctx.fillText("按空格键继续",t/2,e/2+40*s);else if(this.gameState==="game_over"){const a=this.score.playerScore>this.score.aiScore?"玩家":"电脑";this.ctx.fillText(`${a} 获胜！`,t/2,e/2),this.ctx.font=`${i}px Arial`,this.ctx.fillText("按空格键重新开始",t/2,e/2+40*s)}}checkCollisions(){this.ball.checkPaddleCollision(this.player),this.ball.checkPaddleCollision(this.ai)}checkScore(){const{width:t}=this.canvas;this.ball.x<0?(this.score.addAIScore(),this.resetRound()):this.ball.x>t&&(this.score.addPlayerScore(),this.resetRound()),(this.score.playerScore>=this.WINNING_SCORE||this.score.aiScore>=this.WINNING_SCORE)&&(this.gameState="game_over")}}document.addEventListener("DOMContentLoaded",()=>{const o=new f;o.startGame(),document.addEventListener("keydown",t=>{(t.code==="Space"||t.code==="Escape")&&(o.getGameState()==="playing"?o.pauseGame():o.resumeGame())})});document.addEventListener("touchstart",o=>{o.preventDefault()},{passive:!1});
